<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Masjid As-Sunnah Hekinan — Jadwal Sholat, Kegiatan & Donasi</title>

<!-- Tailwind & Lucide -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Tailwind Config (tema Figma) -->
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          fig: {
            primary: "#0EA5E9",
            primaryDark: "#0284C7",
            accent: "#F59E0B",
            success: "#10B981",
            surface: "#FFFFFF",
            text: "#0F172A",
            soft: "#F0F9FF"
          }
        },
        borderRadius: {
          fig: "20px"
        },
        boxShadow: {
          soft: "0 14px 40px -20px rgba(2,8,23,.25)"
        },
        fontFamily: {
          sans: ["Inter","ui-sans-serif","system-ui","-apple-system","Segoe UI","Roboto","Noto Sans","Ubuntu","Cantarell","Helvetica Neue","Arial","sans-serif"]
        }
      }
    }
  }
</script>

<style>
  html{scroll-behavior:smooth}
  [data-lucide]{transition:transform .2s ease}
  .card{transition:transform .15s ease,box-shadow .15s ease}
  .card:hover{transform:translateY(-2px)}
  #progressBar{transition:width 1s ease;background:linear-gradient(90deg,#0EA5E9,#38BDF8)}
  .scrollx-snap{scroll-snap-type:x mandatory}
  .snap-item{scroll-snap-align:start}
  .hide-scrollbar{scrollbar-width:none;-ms-overflow-style:none}
  .hide-scrollbar::-webkit-scrollbar{display:none}
  .tab-slider{position:absolute;bottom:0;height:2px;width:50%;background:#0EA5E9;transition:transform .25s ease}
  .tab-left .tab-slider{transform:translateX(0)}
  .tab-right .tab-slider{transform:translateX(100%)}
</style>
</head>

<body class="font-sans text-fig-text bg-gradient-to-b from-fig-soft to-white">
<!-- ================== HEADER ================== -->
<header class="sticky top-0 bg-white/80 backdrop-blur border-b border-slate-200 z-40">
  <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
    <a href="#top" class="flex gap-3 items-center">
      <img src="logohekinan.jpeg" class="h-10 w-auto rounded-[12px]" alt="Logo">
      <span class="font-extrabold text-lg md:text-xl">Masjid As-Sunnah Hekinan</span>
    </a>
    <div class="flex items-center gap-3 text-sm">
      <a href="#sholat" class="hover:text-fig-primaryDark flex items-center gap-1"><i data-lucide="moon-star" class="w-4 h-4"></i>Sholat</a>
      <a href="#kegiatan" class="hover:text-fig-primaryDark flex items-center gap-1"><i data-lucide="images" class="w-4 h-4"></i>Kegiatan</a>
      <a href="#info" class="hover:text-fig-primaryDark flex items-center gap-1"><i data-lucide="layers" class="w-4 h-4"></i>Info</a>
      <a href="#donasi" class="rounded-[20px] bg-fig-primary hover:bg-fig-primaryDark text-white px-4 py-2 font-semibold shadow-soft">Donasi</a>
      <button id="openData" class="admin-only hidden rounded-[12px] border border-slate-300 px-3 py-2 hover:border-fig-primaryDark flex items-center gap-2">
        <i data-lucide="settings-2" class="w-4 h-4"></i>⚙️ Data
      </button>
    </div>
  </nav>
</header>

<!-- ================== JADWAL SHOLAT ================== -->
<section id="sholat" class="container mx-auto px-4 py-10">
  <div class="rounded-[20px] border border-slate-200 bg-white p-6 shadow-soft card">
    <div class="flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-extrabold flex items-center gap-2"><i data-lucide="moon-star" class="text-fig-primary"></i>Jadwal Sholat</h2>
        <p id="locLabel" class="text-sm text-slate-600 mt-1">Mendeteksi lokasi…</p>
      </div>
      <button id="refreshSholat" class="rounded-[12px] border border-slate-300 hover:border-fig-primaryDark px-3 py-2 text-sm flex items-center gap-2">
        <i data-lucide="refresh-cw" class="w-4 h-4"></i>Perbarui
      </button>
    </div>
    <div id="sholatGrid" class="mt-6 grid grid-cols-2 md:grid-cols-6 gap-3"></div>
    <p class="mt-3 text-xs text-slate-500">Waktu mengikuti zona perangkat Anda.</p>
  </div>
</section>

<!-- ================== KEGIATAN ================== -->
<section id="kegiatan" class="bg-white border-y border-slate-200/70">
  <div class="container mx-auto px-4 py-10">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-2xl md:text-3xl font-extrabold flex items-center gap-2"><i data-lucide="images" class="text-fig-accent"></i>Kegiatan</h2>
      <div class="hidden md:flex items-center gap-2">
        <button id="kgPrev" class="rounded-[12px] border border-slate-300 px-3 py-2 hover:border-fig-primaryDark">◀</button>
        <button id="kgNext" class="rounded-[12px] border border-slate-300 px-3 py-2 hover:border-fig-primaryDark">▶</button>
      </div>
    </div>

    <div class="relative">
      <div id="kgTrack" class="scrollx-snap hide-scrollbar flex gap-4 overflow-x-auto rounded-[20px] border border-slate-200 p-4">
        <figure class="snap-item shrink-0 w-[85%] sm:w-[60%] md:w-[45%] lg:w-[32%] h-64 md:h-80 rounded-[20px] overflow-hidden bg-slate-100">
          <img src="./1.jpeg" class="w-full h-full object-cover" alt="Kegiatan 1" loading="lazy">
        </figure>
        <figure class="snap-item shrink-0 w-[85%] sm:w-[60%] md:w-[45%] lg:w-[32%] h-64 md:h-80 rounded-[20px] overflow-hidden bg-slate-100">
          <img src="./2.jpeg" class="w-full h-full object-cover" alt="Kegiatan 2" loading="lazy">
        </figure>
        <figure class="snap-item shrink-0 w-[85%] sm:w-[60%] md:w-[45%] lg:w-[32%] h-64 md:h-80 rounded-[20px] overflow-hidden bg-slate-100">
          <img src="./3.jpeg" class="w-full h-full object-cover" alt="Kegiatan 3" loading="lazy">
        </figure>
        <figure class="snap-item shrink-0 w-[85%] sm:w-[60%] md:w-[45%] lg:w-[32%] h-64 md:h-80 rounded-[20px] overflow-hidden bg-slate-100">
          <img src="./4.jpeg" class="w-full h-full object-cover" alt="Kegiatan 4" loading="lazy">
        </figure>
        <figure class="snap-item shrink-0 w-[85%] sm:w-[60%] md:w-[45%] lg:w-[32%] h-64 md:h-80 rounded-[20px] overflow-hidden bg-white flex items-center justify-center">
          <img src="./5.jpeg" class="max-w-full max-h-full object-contain" alt="Poster">
        </figure>
      </div>
      <div class="md:hidden absolute inset-y-0 left-0 flex items-center">
        <button id="kgPrevMob" class="m-2 rounded-full bg-white/80 hover:bg-white p-2 shadow-soft">◀</button>
      </div>
      <div class="md:hidden absolute inset-y-0 right-0 flex items-center">
        <button id="kgNextMob" class="m-2 rounded-full bg-white/80 hover:bg-white p-2 shadow-soft">▶</button>
      </div>
    </div>

    <p class="mt-4 text-center text-xs text-slate-500">Geser kiri/kanan atau pakai tombol ◀ ▶.</p>
  </div>
</section>

<!-- ================== INFO (PENGUMUMAN & ARTIKEL) ================== -->
<section id="info" class="container mx-auto px-4 py-10">
  <!-- palette preview -->
  <div class="rounded-[12px] border border-slate-200 bg-white p-3 text-[11px] text-slate-500 mb-4 flex items-center gap-3">
    <span>Palette:</span>
    <span class="w-4 h-4 rounded-full bg-[#0EA5E9]" title="#0EA5E9"></span>
    <span class="w-4 h-4 rounded-full bg-[#0284C7]" title="#0284C7"></span>
    <span class="w-4 h-4 rounded-full bg-[#F59E0B]" title="#F59E0B"></span>
    <span class="w-4 h-4 rounded-full bg-[#10B981]" title="#10B981"></span>
    <span class="w-4 h-4 rounded-full bg-[#F0F9FF]" title="#F0F9FF"></span>
    <span class="ml-2">Radius: 20px</span>
  </div>

  <div id="tabs" class="relative tab-left">
    <div class="flex gap-2">
      <button id="tabPengumuman" class="flex-1 rounded-[12px] px-4 py-2 text-sm font-semibold border border-slate-300 bg-slate-50">Pengumuman</button>
      <button id="tabArtikel" class="flex-1 rounded-[12px] px-4 py-2 text-sm font-semibold border border-slate-300 bg-slate-50">Artikel</button>
    </div>
    <span class="tab-slider"></span>
  </div>

  <div id="wrapPengumuman" class="mt-6 grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  <p id="boardEmpty" class="hidden text-sm text-slate-500">Belum ada pengumuman.</p>

  <div id="wrapArtikel" class="mt-6 hidden">
    <div class="flex justify-end">
      <div class="relative">
        <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
        <input id="searchArtikel" placeholder="Cari artikel…" class="pl-9 pr-3 py-2 rounded-[12px] border border-slate-300 focus:border-fig-primary text-sm w-64 max-w-full">
      </div>
    </div>
    <div id="artikelList" class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    <p id="artikelEmpty" class="hidden text-sm text-slate-500">Belum ada artikel.</p>
  </div>
</section>

<!-- ================== DONASI ================== -->
<section id="donasi" class="container mx-auto px-4 pb-12">
  <h2 class="text-2xl font-extrabold mb-4 flex items-center gap-2"><i data-lucide="heart-handshake" class="text-fig-success"></i>Progres Donasi</h2>

  <div class="rounded-[20px] border border-slate-200 bg-fig-soft p-6 card shadow-soft">
    <div class="flex justify-between items-end">
      <div><p class="text-sm text-slate-600">Terkumpul</p><p id="terkumpulLabel" class="text-3xl font-bold">JPY 0</p></div>
      <div class="text-right"><p class="text-sm text-slate-600">Target</p><p id="targetLabel" class="text-2xl font-bold">JPY 0</p></div>
    </div>
    <div class="mt-4 w-full bg-white rounded-full border border-slate-200 overflow-hidden"><div id="progressBar" class="h-3 w-0"></div></div>
    <p class="mt-2 text-sm text-slate-600"><span id="percentLabel">0</span>% tercapai</p>

    <!-- Nominal -->
    <div class="mt-6 rounded-[20px] border border-slate-200 bg-white p-5">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div>
          <label class="text-sm font-semibold">Nominal (JPY)</label>
          <input id="inputJPY" type="number" min="1000" step="1000" placeholder="Masukkan JPY"
                 class="mt-1 w-full rounded-[12px] border border-slate-300 px-3 py-2 focus:border-fig-primary"/>
          <div class="mt-2 flex flex-wrap gap-2 text-xs">
            <button class="quick-jpy border rounded-[12px] px-3 py-1" data-v="1000">1.000</button>
            <button class="quick-jpy border rounded-[12px] px-3 py-1" data-v="5000">5.000</button>
            <button class="quick-jpy border rounded-[12px] px-3 py-1" data-v="10000">10.000</button>
            <button class="quick-jpy border rounded-[12px] px-3 py-1" data-v="20000">20.000</button>
          </div>
        </div>
        <div>
          <label class="text-sm font-semibold">Nominal (IDR)</label>
          <input id="inputIDR" type="number" min="10000" step="1000" placeholder="Masukkan IDR"
                 class="mt-1 w-full rounded-[12px] border border-slate-300 px-3 py-2 focus:border-fig-primary"/>
          <div class="mt-2 flex flex-wrap gap-2 text-xs">
            <button class="quick-idr border rounded-[12px] px-3 py-1" data-v="50000">50.000</button>
            <button class="quick-idr border rounded-[12px] px-3 py-1" data-v="100000">100.000</button>
            <button class="quick-idr border rounded-[12px] px-3 py-1" data-v="200000">200.000</button>
            <button class="quick-idr border rounded-[12px] px-3 py-1" data-v="500000">500.000</button>
          </div>
        </div>
      </div>
      <button id="donasiBtn" class="mt-4 w-full rounded-[20px] bg-fig-primary hover:bg-fig-primaryDark text-white font-semibold px-6 py-3">
        Konfirmasi via WhatsApp
      </button>
      <p class="mt-2 text-[11px] text-slate-500">Minimal 1.000 JPY atau 10.000 IDR.</p>
    </div>

    <!-- Rekening -->
    <div class="mt-6 grid md:grid-cols-2 gap-6">
      <div class="rounded-[20px] border border-slate-200 bg-white p-5">
        <h3 class="font-bold">🇯🇵 Jepang — Yucho Bank</h3>
        <p class="text-sm text-slate-700 mt-1">a.n. <b>Yoshimine Adelfa</b></p>
        <p class="text-sm text-slate-700">No. Rekening: <span id="rekYucho">12160-00457031</span></p>
        <button data-copy="#rekYucho" class="mt-2 text-xs border rounded-[12px] px-3 py-1 hover:border-fig-primaryDark">Salin No. Rek</button>
      </div>
      <div class="rounded-[20px] border border-slate-200 bg-white p-5">
        <h3 class="font-bold">🇮🇩 Indonesia — Bank Syariah Indonesia</h3>
        <p class="text-sm text-slate-700 mt-1">a.n. <b>Hidayah Cinta Hekinan</b></p>
        <p class="text-sm text-slate-700">No. Rekening: <span id="rekBsi">7329283768</span></p>
        <button data-copy="#rekBsi" class="mt-2 text-xs border rounded-[12px] px-3 py-1 hover:border-fig-primaryDark">Salin No. Rek</button>
      </div>
    </div>
  </div>
</section>

<!-- ================== FOOTER ================== -->
<footer class="bg-white">
  <div class="container mx-auto px-4 py-10">
    <div class="grid md:grid-cols-3 gap-8">
      <div>
        <img src="logohekinan.jpeg" alt="Logo" class="h-12 w-auto mb-3 rounded-[12px]">
        <h3 class="font-bold">Masjid As-Sunnah Hekinan</h3>
        <p class="mt-1 text-sm text-slate-700">1 Chome-8 Dojoyamamachi, Hekinan, Aichi 447-0864</p>
        <p class="text-sm text-slate-700">Email: hekinanmosque@gmail.com</p>
      </div>
      <div>
        <h3 class="font-bold">Tautan</h3>
        <ul class="mt-2 space-y-2 text-sm">
          <li><a href="#sholat" class="hover:text-fig-primaryDark">Jadwal Sholat</a></li>
          <li><a href="#kegiatan" class="hover:text-fig-primaryDark">Kegiatan</a></li>
          <li><a href="#info" class="hover:text-fig-primaryDark">Pengumuman & Artikel</a></li>
          <li><a href="#donasi" class="hover:text-fig-primaryDark">Donasi</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold">Ikuti Kami</h3>
        <div class="mt-2 flex items-center gap-3">
          <a href="https://www.instagram.com/assunnahhekinan" target="_blank" rel="noopener" class="flex items-center gap-2 px-3 py-2 rounded-[12px] border hover:border-fig-primaryDark text-sm">
            <i data-lucide="instagram" class="w-4 h-4"></i>Instagram
          </a>
          <a href="https://www.youtube.com/@assunnahhekinan" target="_blank" rel="noopener" class="flex items-center gap-2 px-3 py-2 rounded-[12px] border hover:border-fig-primaryDark text-sm">
            <i data-lucide="youtube" class="w-4 h-4"></i>YouTube
          </a>
          <a href="https://www.tiktok.com/" target="_blank" rel="noopener" class="flex items-center gap-2 px-3 py-2 rounded-[12px] border hover:border-fig-primaryDark text-sm">
            <i data-lucide="music-3" class="w-4 h-4"></i>TikTok
          </a>
        </div>
      </div>
    </div>
    <div class="mt-8 border-t border-slate-200 pt-6 text-xs text-slate-500 flex flex-col md:flex-row justify-between">
      <p>© <span id="year"></span> Masjid As-Sunnah Hekinan.</p>
      <p>Designed with ♥️ Abu Khayla.</p>
    </div>
  </div>
</footer>

<!-- ================== APP SCRIPT ================== -->
<script type="module">
  const $=(s,r=document)=>r.querySelector(s), $$=(s,r=document)=>[...r.querySelectorAll(s)];
  $('#year').textContent=new Date().getFullYear(); lucide.createIcons();

  /* ===== Admin gate ===== */
  const ADMIN_CODE='as-sunnah-2025';
  const isAdmin=()=>localStorage.getItem('is_admin')==='1'||location.search.includes('admin=1');
  if(isAdmin()) $$('.admin-only').forEach(el=>el.classList.remove('hidden'));
  document.addEventListener('keydown',e=>{
    if(e.ctrlKey&&e.altKey&&e.key.toLowerCase()==='a'){
      const c=prompt('Masukkan kode admin:');
      if(c===ADMIN_CODE){localStorage.setItem('is_admin','1');alert('Admin aktif.');$$('.admin-only').forEach(el=>el.classList.remove('hidden'));}
    }
  });
  $('#openData')?.addEventListener('click',()=>{
    const dlg=document.createElement('div');
    dlg.className='fixed inset-0 bg-black/40 flex items-center justify-center z-50';
    dlg.innerHTML=`<div class="bg-white p-6 rounded-[20px] shadow-soft w-full max-w-xl">
      <div class="flex justify-between items-center mb-2">
        <h3 class="font-bold flex items-center gap-2"><i data-lucide="database"></i>Sumber Data</h3>
        <button id="closeDlg">✕</button>
      </div>
      <p class="text-sm text-slate-600">Tempel URL Google Sheet yg sudah <b>Publish to the web → CSV</b>.</p>
      <div class="grid md:grid-cols-2 gap-4 mt-4">
        <div><label class="text-sm font-semibold">CSV Pengumuman</label><input id="csvP" class="mt-1 w-full rounded-[12px] border border-slate-300 px-3 py-2" value="${localStorage.getItem('sheet_pengumuman')||''}"></div>
        <div><label class="text-sm font-semibold">CSV Artikel</label><input id="csvA" class="mt-1 w-full rounded-[12px] border border-slate-300 px-3 py-2" value="${localStorage.getItem('sheet_artikel')||''}"></div>
      </div>
      <div class="text-right mt-4"><button id="saveDlg" class="rounded-[12px] bg-fig-primary hover:bg-fig-primaryDark text-white px-4 py-2 text-sm">Simpan</button></div>
    </div>`;
    document.body.appendChild(dlg); lucide.createIcons();
    dlg.addEventListener('click',e=>{ if(e.target===dlg||e.target.id==='closeDlg') dlg.remove(); });
    $('#saveDlg').onclick=()=>{ localStorage.setItem('sheet_pengumuman',$('#csvP').value.trim()); localStorage.setItem('sheet_artikel',$('#csvA').value.trim()); alert('Disimpan. Refresh halaman.'); dlg.remove(); loadInfo(); };
  });

  /* ===== Jadwal Sholat ===== */
  const FALLBACK={lat:34.884,lon:136.993};
  async function getTimes(lat,lon){ const j=await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=2`).then(r=>r.json()); return j.data?.timings; }
  function tile(label,time,ic){ const d=document.createElement('div'); d.className="rounded-[20px] border border-slate-200 p-4 text-center bg-white"; d.innerHTML=`<i data-lucide="${ic}" class="w-5 h-5 mx-auto text-fig-primary mb-2"></i><div class="text-xs text-slate-500">${label}</div><div class="mt-1 text-xl font-bold">${time||'—'}</div>`; return d; }
  async function renderSholat(){
    const g=$("#sholatGrid"); g.innerHTML='<p>Memuat…</p>';
    let pos=null; try{ pos=await new Promise(res=>navigator.geolocation.getCurrentPosition(p=>res({lat:p.coords.latitude,lon:p.coords.longitude}),()=>res(null),{enableHighAccuracy:true,timeout:7000})) }catch{}
    pos=pos||FALLBACK; $('#locLabel').textContent=`Lokasi: (${pos.lat.toFixed(3)}, ${pos.lon.toFixed(3)})`;
    try{
      const t=await getTimes(pos.lat,pos.lon); g.innerHTML='';
      const map={Fajr:['Subuh','sunrise'],Sunrise:['Syuruq','sun'],Dhuhr:['Dzuhur','clock'],Asr:['Ashar','cloud-sun'],Maghrib:['Maghrib','moon'],Isha:['Isya','star']};
      Object.keys(map).forEach(k=> g.appendChild(tile(map[k][0], t?.[k], map[k][1])) ); lucide.createIcons();
    }catch{ g.innerHTML='<p class="text-red-600">Gagal memuat jadwal. Coba Perbarui.</p>'; }
  }
  $('#refreshSholat').addEventListener('click',renderSholat); renderSholat();

  /* ===== Slideshow Kegiatan ===== */
  (function(){
    const track=$("#kgTrack"); if(!track) return;
    const prevs=[$("#kgPrev"),$("#kgPrevMob")].filter(Boolean);
    const nexts=[$("#kgNext"),$("#kgNextMob")].filter(Boolean);
    const page=()=>track.clientWidth;
    const go=d=>track.scrollBy({left:d*page(),behavior:'smooth'});
    prevs.forEach(b=>b?.addEventListener('click',()=>go(-1)));
    nexts.forEach(b=>b?.addEventListener('click',()=>go(1)));
    let timer=setInterval(()=>go(1),6000);
    track.addEventListener('mouseenter',()=>clearInterval(timer));
    track.addEventListener('mouseleave',()=>timer=setInterval(()=>go(1),6000));
  })();

  /* ===== CSV parser aman ===== */
  function parseCSV(text){
    const rows=[]; let i=0, cur='', row=[], inQ=false;
    while(i<text.length){
      const c=text[i];
      if(c=='"'){ if(inQ && text[i+1]=='"'){cur+='"'; i+=2; continue;} inQ=!inQ; i++; continue; }
      if(!inQ && c==','){ row.push(cur); cur=''; i++; continue; }
      if(!inQ && (c=='\n'||c=='\r')){ if(cur!==''||row.length){ row.push(cur); rows.push(row); row=[]; cur=''; } if(c=='\r'&&text[i+1]=='\n') i++; i++; continue; }
      cur+=c; i++;
    }
    if(cur!==''||row.length){ row.push(cur); rows.push(row); }
    if(!rows.length) return [];
    const head=rows[0].map(h=>h.trim().toLowerCase());
    return rows.slice(1).map(cols=>{ const o={}; head.forEach((h,idx)=> o[h]=(cols[idx]||'').trim()); return o; });
  }
  const normalizeUrl=u=>{ if(!u) return ''; u=u.trim(); if(!/^https?:\/\//i.test(u)) u='https://'+u; return u; };

  /* ===== Info (Pengumuman & Artikel) ===== */
  async function loadCsv(u){ if(!u) return null; try{ const t=await fetch(u,{cache:'no-store'}).then(r=>r.text()); return parseCSV(t); }catch{return null;} }
  async function loadJson(u){ try{ return await fetch(u,{cache:'no-store'}).then(r=>r.json()); }catch{return null;} }
  async function getPeng(){ return (await loadCsv(localStorage.getItem('sheet_pengumuman'))) || await loadJson('pengumuman.json') || []; }
  async function getArt(){ return (await loadCsv(localStorage.getItem('sheet_artikel')))    || await loadJson('artikel.json')    || []; }

  function cardPeng({title,date,desc,link}){
    const el=document.createElement('article'); el.className="rounded-[20px] border border-slate-200 bg-white p-5 shadow-soft card";
    const d=date?new Date(date):null; const disp=d&&!isNaN(d)?d.toLocaleDateString('id-ID',{weekday:'short',year:'numeric',month:'short',day:'numeric'}):'';
    el.innerHTML=`<div class="text-xs text-slate-500">${disp}</div>
      <h3 class="mt-1 font-bold">${title||''}</h3>
      <p class="mt-2 text-sm text-slate-700">${desc||''}</p>
      ${link?`<a href="${normalizeUrl(link)}" target="_blank" rel="noopener" class="inline-flex items-center gap-2 mt-3 text-fig-primary hover:underline text-sm"><i data-lucide="arrow-right"></i> Detail</a>`:''}`;
    return el;
  }
  function cardArt({title,excerpt,link,tag}){
    const el=document.createElement('article'); el.className="rounded-[20px] border border-slate-200 bg-white p-5 shadow-soft card";
    const badges=(tag||'').split('|').filter(Boolean).map(t=>`<span class="text-xs px-2 py-1 rounded-full bg-slate-100">${t}</span>`).join('');
    el.innerHTML=`<h3 class="font-bold">${title||''}</h3>
      <p class="mt-2 text-sm text-slate-700">${excerpt||''}</p>
      <div class="mt-3 flex flex-wrap gap-2">${badges}</div>
      ${link?`<a href="${normalizeUrl(link)}" target="_blank" rel="noopener" class="inline-flex items-center gap-2 mt-3 text-fig-success hover:underline text-sm"><i data-lucide="book-open"></i> Baca</a>`:''}`;
    return el;
  }

  async function loadInfo(){
    const P=await getPeng(); const wrapP=$("#wrapPengumuman"), emptyP=$("#boardEmpty");
    wrapP.innerHTML=''; if(!P.length){ emptyP.classList.remove('hidden'); } else { emptyP.classList.add('hidden'); P.forEach(d=>wrapP.appendChild(cardPeng(d))); }

    const A=await getArt(); const list=$("#artikelList"), emptyA=$("#artikelEmpty");
    function renderA(q=''){ const s=q.toLowerCase(); list.innerHTML=''; const data=A.filter(a=>!s||(a.title||'').toLowerCase().includes(s)||(a.excerpt||'').toLowerCase().includes(s)||(a.tag||'').toLowerCase().includes(s)); if(!data.length){ emptyA.classList.remove('hidden'); } else { emptyA.classList.add('hidden'); data.forEach(d=>list.appendChild(cardArt(d))); } lucide.createIcons(); }
    renderA(); $('#searchArtikel')?.addEventListener('input',e=>renderA(e.target.value)); lucide.createIcons();
  }
  loadInfo();

  // Tab switch
  $('#tabPengumuman').addEventListener('click',()=>{$('#wrapPengumuman').classList.remove('hidden');$('#wrapArtikel').classList.add('hidden');$('#tabs').classList.add('tab-left');$('#tabs').classList.remove('tab-right');});
  $('#tabArtikel').addEventListener('click',()=>{$('#wrapPengumuman').classList.add('hidden');$('#wrapArtikel').classList.remove('hidden');$('#tabs').classList.remove('tab-left');$('#tabs').classList.add('tab-right');});

  /* ===== Donasi – konfigurasi ===== */
  const TARGET=42000000;   // JPY
  const TERKUMPUL=5290797; // JPY
  const WA_NUMBER='818013909425';

  // Progress bar
  (function(){
    $('#terkumpulLabel').textContent=new Intl.NumberFormat('id-ID',{style:'currency',currency:'JPY',maximumFractionDigits:0}).format(TERKUMPUL);
    $('#targetLabel').textContent=new Intl.NumberFormat('id-ID',{style:'currency',currency:'JPY',maximumFractionDigits:0}).format(TARGET);
    const p=Math.min(100,Math.round((TERKUMPUL/TARGET)*100));
    $('#percentLabel').textContent=p;
    const bar=$('#progressBar'); bar.style.width='0%'; requestAnimationFrame(()=>setTimeout(()=>bar.style.width=p+'%',40));
  })();

  // Nominal & WA
  $$('.quick-jpy').forEach(b=>b.addEventListener('click',()=>$('#inputJPY').value=b.dataset.v));
  $$('.quick-idr').forEach(b=>b.addEventListener('click',()=>$('#inputIDR').value=b.dataset.v));
  const fmtJPY=n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'JPY',maximumFractionDigits:0}).format(n||0);
  const fmtIDR=n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n||0);
  $('#donasiBtn').addEventListener('click',()=>{
    const j=Number($('#inputJPY').value)||0, r=Number($('#inputIDR').value)||0;
    if(j<1000 && r<10000){ alert('Minimal 1.000 JPY atau 10.000 IDR.'); return; }
    const txt=encodeURIComponent(`Assalamu'alaikum, saya ingin donasi sebesar ${j>0?fmtJPY(j):fmtIDR(r)} untuk Masjid As-Sunnah Hekinan.`);
    window.open(`https://wa.me/${WA_NUMBER}?text=${txt}`,'_blank');
  });

  // Salin no rekening
  $$('[data-copy]').forEach(btn=>btn.addEventListener('click',()=>{
    const sel=btn.getAttribute('data-copy'); const t=document.querySelector(sel); if(!t) return;
    navigator.clipboard.writeText(String(t.textContent).trim());
    const o=btn.textContent; btn.textContent='Disalin!'; setTimeout(()=>btn.textContent=o,1100);
  }));
</script>
</body>
</html>

