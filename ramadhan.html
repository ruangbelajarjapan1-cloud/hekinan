<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ramadhan Challenge â€” Masjid As-Sunnah Hekinan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fig: { primary:"#0EA5E9", primaryDark:"#0284C7", accent:"#F59E0B", success:"#10B981", text:"#0F172A", soft:"#F0F9FF" }
          },
          fontFamily: { arab: ['Amiri', 'serif'] },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 6s ease-in-out infinite',
            'pop-in': 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
          },
          keyframes: {
            float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
            popIn: { '0%': { opacity: '0', transform: 'scale(0.8)' }, '100%': { opacity: '1', transform: 'scale(1)' } }
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap" rel="stylesheet">
  <style>
    .bg-grid-pattern { background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
  </style>
</head>
<body class="font-sans text-slate-800 bg-slate-50 pb-20 overflow-x-hidden">

  <div id="liveToast" class="fixed bottom-24 left-4 z-50 transform transition-all duration-500 translate-y-24 opacity-0 pointer-events-none">
    <div class="bg-white/95 backdrop-blur border border-emerald-100 shadow-2xl rounded-full py-3 px-5 flex items-center gap-3">
        <div class="bg-emerald-100 p-2 rounded-full text-emerald-600"><i data-lucide="zap" class="w-4 h-4"></i></div>
        <div>
            <p class="text-[10px] font-bold text-slate-800 leading-tight"><span id="toastName">Hamba Allah</span></p>
            <p class="text-[10px] text-emerald-600 leading-tight">Baru saja wakaf <span id="toastNominal">Â¥1.000</span></p>
        </div>
    </div>
  </div>

  <header class="sticky top-0 bg-white/90 backdrop-blur border-b border-slate-200 z-40">
    <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
      <a href="index.html" class="flex gap-2 items-center text-slate-600 hover:text-emerald-600 font-bold transition-colors text-sm md:text-base">
        <i data-lucide="arrow-left" class="w-4 h-4"></i> <span data-i18n="rmd_page_back">Kembali</span>
      </a>
      <button id="langToggle" class="text-xs font-bold border border-slate-300 rounded-lg px-2 py-1 hover:bg-slate-50">ID | EN</button>
    </nav>
  </header>

  <section class="relative bg-emerald-900 text-white py-16 overflow-hidden">
    <div class="absolute inset-0 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/arabesque.png');"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-emerald-900/50 to-emerald-800/90"></div>
    <div class="absolute top-0 left-1/4 w-64 h-64 bg-amber-400/20 rounded-full blur-[100px] animate-pulse-slow"></div>
    <div class="absolute top-10 right-10 opacity-20 animate-float"><i data-lucide="moon" class="w-32 h-32 text-amber-200"></i></div>
    
    <div class="container mx-auto px-4 relative z-10 text-center">
      <span class="inline-flex items-center gap-2 py-1 px-4 rounded-full bg-red-600/90 border border-red-400 text-[10px] md:text-xs font-bold text-white mb-6 animate-bounce">
        <i data-lucide="alert-circle" class="w-3 h-3"></i> <span data-i18n="rmd_page_deadline">Deadline: 31 Mei 2026</span>
      </span>
      <h1 class="text-3xl md:text-5xl font-extrabold mb-4 font-arab leading-relaxed text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-500 drop-shadow-sm" data-i18n="rmd_hero_title">Wakaf MÂ² Surga</h1>
      <p class="text-emerald-100 max-w-xl mx-auto text-base md:text-lg mb-8 px-2 leading-relaxed" data-i18n="rmd_hero_desc">
        "Barangsiapa membangun masjid karena Allah, maka Allah akan membangunkan baginya rumah (istana) di surga."
      </p>
      
      <div class="max-w-md mx-auto bg-emerald-950/40 p-4 rounded-2xl border border-emerald-700/50 backdrop-blur-md shadow-lg mt-6">
        <div class="text-center border-b border-emerald-800/50 pb-3 mb-3">
            <p id="timeLabel" class="text-[10px] md:text-xs font-bold text-emerald-300 mb-1 uppercase tracking-wider">Waktu Hekinan</p>
            <div id="timeCountdown" class="text-3xl md:text-4xl font-mono font-extrabold text-white tracking-widest drop-shadow-md">--:--:--</div>
        </div>
        <div class="flex justify-between items-center text-xs px-2">
            <div class="text-center">
                <span class="block text-emerald-400 font-bold uppercase text-[10px]">Subuh</span>
                <span id="jadwalSubuh" class="block text-white font-mono text-lg font-bold">--:--</span>
            </div>
            <div class="h-8 w-[1px] bg-emerald-700/50"></div>
            <div class="text-center">
                <span class="block text-amber-400 font-bold uppercase text-[10px]">Maghrib</span>
                <span id="jadwalMaghrib" class="block text-white font-mono text-lg font-bold">--:--</span>
            </div>
        </div>
      </div>

      <div class="mt-8 flex justify-center items-center gap-[-10px] relative z-20 opacity-90 hover:opacity-100 transition-opacity">
        <div class="flex -space-x-2">
            <div class="w-8 h-8 rounded-full border-2 border-emerald-900 bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-600">A</div>
            <div class="w-8 h-8 rounded-full border-2 border-emerald-900 bg-slate-300 flex items-center justify-center text-[10px] font-bold text-slate-600">H</div>
            <div class="w-8 h-8 rounded-full border-2 border-emerald-900 bg-slate-100 flex items-center justify-center text-[10px] font-bold text-slate-600">S</div>
            <div class="w-8 h-8 rounded-full border-2 border-emerald-900 bg-amber-500 text-white flex items-center justify-center text-[10px] font-bold shadow-lg">+400</div>
        </div>
       <p class="ml-3 text-xs text-emerald-100 font-medium text-left leading-tight">
    <span data-i18n="rmd_social_joined">Orang Baik telah bergabung.</span><br>
    <span class="text-amber-400 font-bold underline decoration-amber-400/50" data-i18n="rmd_social_turn">Giliran Anda sekarang!</span>
</p>
    </div>
  </section>

  <section class="container mx-auto px-4 -mt-10 relative z-20">
    <div class="max-w-xl mx-auto">
      <div class="bg-white rounded-3xl shadow-[0_25px_60px_-15px_rgba(0,0,0,0.3)] overflow-hidden border-2 border-amber-400/40 relative transform hover:-translate-y-1 transition-all duration-300">
        <div class="absolute top-0 right-0 w-24 h-24 overflow-hidden z-10 pointer-events-none">
            <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white text-[10px] font-bold py-1 px-10 absolute top-5 right-[-35px] rotate-45 shadow-md tracking-widest">BEST</div>
        </div>
        <div class="bg-purple-50/50 bg-grid-pattern p-8 text-center border-b border-purple-100 relative">
          <div class="w-24 h-24 mx-auto bg-white rounded-full p-1 shadow-xl shadow-purple-200/50 mb-4 border-4 border-amber-100 relative group">
             <div class="absolute inset-0 bg-amber-400 rounded-full opacity-0 group-hover:opacity-20 transition-opacity animate-pulse"></div>
             <img src="logohekinan.jpeg" alt="Logo Masjid" class="w-full h-full object-cover rounded-full">
             <div class="absolute bottom-0 right-0 bg-blue-500 text-white p-1 rounded-full border-2 border-white shadow-sm" title="Terverifikasi"><i data-lucide="check" class="w-3 h-3 stroke-[4]"></i></div>
          </div>
          <h2 class="text-2xl font-extrabold text-slate-900 mb-1" data-i18n="rmd_card_title">Paket MÂ² Surga</h2>
          <p class="text-sm text-slate-500 font-medium" data-i18n="rmd_card_subtitle">Investasi pembebasan lahan Masjid As-Sunnah Hekinan.</p>
        </div>
        <div class="p-6 md:p-8 bg-white relative">
          <ul class="space-y-4 mb-8">
            <li class="flex items-start gap-3 text-sm md:text-base text-slate-700 p-3 rounded-xl bg-slate-50 border border-slate-100 hover:bg-emerald-50 hover:border-emerald-100 transition-colors">
                <div class="bg-emerald-100 p-1 rounded-full mt-0.5"><i data-lucide="infinity" class="text-emerald-600 w-4 h-4"></i></div>
                <span data-i18n="rmd_benefit_1">Pahala jariyah yang terus mengalir abadi</span>
            </li>
            <li class="flex items-start gap-3 text-sm md:text-base text-slate-700 p-3 rounded-xl bg-slate-50 border border-slate-100 hover:bg-emerald-50 hover:border-emerald-100 transition-colors">
                <div class="bg-emerald-100 p-1 rounded-full mt-0.5"><i data-lucide="hammer" class="text-emerald-600 w-4 h-4"></i></div>
                <span data-i18n="rmd_benefit_2">Ikut melunasi bangunan sebelum Mei 2026</span>
            </li>
            <li class="flex items-start gap-3 text-sm md:text-base text-slate-700 p-3 rounded-xl bg-slate-50 border border-slate-100 hover:bg-emerald-50 hover:border-emerald-100 transition-colors">
                <div class="bg-emerald-100 p-1 rounded-full mt-0.5"><i data-lucide="users" class="text-emerald-600 w-4 h-4"></i></div>
                <span data-i18n="rmd_benefit_3">Didoakan oleh ribuan jamaah & malaikat</span>
            </li>
          </ul>
          <button onclick="window.openRamadhanPopup()" class="group relative w-full bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg py-4 rounded-2xl shadow-lg shadow-emerald-500/40 transition-all transform active:scale-95 flex items-center justify-center gap-2 overflow-hidden">
            <div class="absolute top-0 -left-[100%] w-full h-full bg-gradient-to-r from-transparent via-white/30 to-transparent skew-x-12 group-hover:animate-[shimmer_1s_infinite]"></div>
            <span class="relative z-10" data-i18n="rmd_btn_open">Ambil Bagian Wakaf</span>
            <i data-lucide="arrow-right" class="w-5 h-5 relative z-10 group-hover:translate-x-1 transition-transform"></i>
          </button>
          <p class="text-center text-[10px] text-slate-400 mt-4 flex justify-center items-center gap-1"><i data-lucide="lock" class="w-3 h-3"></i> Amanah & Transparan</p>
        </div>
      </div>
    </div>
  </section>

  <section class="container mx-auto px-4 py-16">
    <div class="max-w-2xl mx-auto text-center mb-10">
        <h3 class="text-xl font-bold text-slate-800 mb-2" data-i18n="rmd_section_title">Mengapa Wakaf di Ramadhan?</h3>

<div><h4 class="font-bold text-slate-800 text-sm" data-i18n="rmd_reason_1_title">Pahala Berlipat Ganda</h4><p class="text-xs text-slate-500 mt-1" data-i18n="rmd_reason_1_desc">Sunnah jadi wajib, wajib jadi 70x lipat.</p></div>

<div><h4 class="font-bold text-slate-800 text-sm" data-i18n="rmd_reason_2_title">Mengejar Deadline Mei</h4><p class="text-xs text-slate-500 mt-1" data-i18n="rmd_reason_2_desc">Menyelamatkan aset umat sebelum jatuh tempo.</p></div>

<div><h4 class="font-bold text-slate-800 text-sm" data-i18n="rmd_reason_3_title">Hadiah Orang Tua</h4><p class="text-xs text-slate-500 mt-1" data-i18n="rmd_reason_3_desc">Wakaf atas nama orang tua yang sudah wafat.</p></div>

<div><h4 class="font-bold text-slate-800 text-sm" data-i18n="rmd_reason_4_title">Naungan di Akhirat</h4><p class="text-xs text-slate-500 mt-1" data-i18n="rmd_reason_4_desc">Sedekah akan menjadi naungan di hari kiamat.</p></div>
    </div>
  </section>

  <div id="wakafModal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 text-left font-sans">
    <div id="modalBackdrop" class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity cursor-pointer"></div>
    <div class="relative w-full max-w-md bg-white rounded-2xl shadow-2xl transform scale-95 transition-all animate-[fadeUp_0.3s_ease-out] flex flex-col max-h-[90vh]">
      
      <div id="viewForm" class="flex flex-col h-full">
          <div class="p-6 bg-emerald-600 rounded-t-2xl text-center relative overflow-hidden shrink-0">
            <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')]"></div>
            <button id="btnCloseModal" class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="w-16 h-16 mx-auto bg-white p-1 rounded-full flex items-center justify-center mb-3 border-2 border-white/50 text-white relative z-10 shadow-lg">
                <img src="logohekinan.jpeg" class="w-full h-full rounded-full object-cover">
            </div>
            <h3 class="font-extrabold text-2xl text-white relative z-10" data-i18n="rmd_modal_title">Komitmen Wakaf</h3>
            <p class="text-emerald-100 text-sm relative z-10" data-i18n="rmd_modal_subtitle">Pilih nominal sedekah rutin</p>
          </div>

          <div class="p-6 overflow-y-auto bg-slate-50 grow">
            
            <div class="flex bg-slate-200 p-1 rounded-xl mb-6 relative">
                <div id="modeActiveBg" class="absolute left-1 top-1 bottom-1 w-[calc(50%-4px)] bg-white rounded-lg shadow-sm transition-all duration-300"></div>
                <button id="btnModeDaily" class="flex-1 relative z-10 text-xs font-bold py-2.5 text-emerald-600 transition-colors text-center" data-i18n="rmd_mode_daily">Harian (30 Hari)</button>
                <button id="btnModeWeekly" class="flex-1 relative z-10 text-xs font-bold py-2.5 text-slate-500 transition-colors text-center" data-i18n="rmd_mode_weekly">Pekanan (4 Jumat)</button>
            </div>

            <div class="space-y-3">
              <label class="relative flex items-center p-4 bg-white border-2 border-slate-200 rounded-xl cursor-pointer hover:border-emerald-500 transition-all group shadow-sm">
                <input type="radio" name="nominalWakaf" value="1000" class="peer sr-only">
                <div class="w-5 h-5 rounded-full border-2 border-slate-300 peer-checked:bg-emerald-500 peer-checked:border-emerald-500 mr-4 shrink-0 transition-all"></div>
                <div class="flex-1"><span class="block font-bold text-slate-800 text-lg">Â¥1.000 <span class="text-sm font-normal text-slate-400 label-period">/hari</span></span></div>
                <div class="absolute inset-0 border-2 border-emerald-500 rounded-xl opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"></div>
              </label>
              <label class="relative flex items-center p-4 bg-white border-2 border-slate-200 rounded-xl cursor-pointer hover:border-emerald-500 transition-all group shadow-sm">
                <div class="absolute -top-2.5 right-4 bg-amber-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm z-10">POPULER</div>
                <input type="radio" name="nominalWakaf" value="5000" class="peer sr-only">
                <div class="w-5 h-5 rounded-full border-2 border-slate-300 peer-checked:bg-emerald-500 peer-checked:border-emerald-500 mr-4 shrink-0 transition-all"></div>
                <div class="flex-1"><span class="block font-bold text-slate-800 text-lg">Â¥5.000 <span class="text-sm font-normal text-slate-400 label-period">/hari</span></span></div>
                <div class="absolute inset-0 border-2 border-emerald-500 rounded-xl opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"></div>
              </label>
              <label class="relative flex flex-col p-4 bg-white border-2 border-slate-200 rounded-xl cursor-pointer hover:border-emerald-500 transition-all group shadow-sm">
                <div class="flex items-center">
                  <input type="radio" name="nominalWakaf" value="custom" id="radioCustom" class="peer sr-only">
                  <div class="w-5 h-5 rounded-full border-2 border-slate-300 peer-checked:bg-emerald-500 peer-checked:border-emerald-500 mr-4 shrink-0 transition-all"></div>
                  <span class="font-bold text-slate-800" data-i18n="rmd_opt_custom">Nominal Lainnya</span>
                </div>
                <div id="customInputBox" class="hidden mt-3 ml-9 animate-[fadeUp_0.2s_ease-out]">
                  <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">Â¥</span><input type="number" id="inputCustomNominal" placeholder="2000" class="w-full bg-slate-50 border border-slate-300 rounded-lg py-2 pl-8 pr-3 text-sm focus:outline-none focus:border-emerald-500"></div>
                </div>
                <div class="absolute inset-0 border-2 border-emerald-500 rounded-xl opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"></div>
              </label>
            </div>

            <div id="impactBox" class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3 hidden transition-all">
                <div class="bg-amber-100 p-1.5 rounded-full text-amber-600 mt-0.5 shrink-0"><i data-lucide="lightbulb" class="w-4 h-4"></i></div>
                <p class="text-xs text-slate-600 leading-relaxed"><span id="impactText" class="font-bold text-amber-700 text-sm"></span></p>
            </div>

            <div class="mt-6">
              <label class="block text-xs font-bold text-slate-500 uppercase mb-2" data-i18n="rmd_label_name">Nama Anda</label>
              <div class="relative">
                <i data-lucide="user" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-emerald-500"></i>
                <input id="inputNamaPeserta" type="text" data-placeholder="rmd_ph_name" placeholder="Hamba Allah..." class="w-full pl-9 pr-4 py-3 rounded-xl border border-slate-300 focus:outline-none focus:border-emerald-500 bg-white">
              </div>
              
              <div class="mt-4 pt-3 border-t border-slate-100">
                <label class="flex items-start gap-3 cursor-pointer group select-none">
                    <div class="relative mt-0.5">
                        <input type="checkbox" id="checkDedikasi" class="peer sr-only">
                        <div class="w-9 h-5 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pink-500"></div>
                    </div>
                    <div class="flex-1">
                        <span class="block text-xs font-bold text-slate-700 group-hover:text-pink-600 transition-colors" data-i18n="rmd_dedication_ask">Niatkan pahala untuk Orang Tua?</span>
                        <span class="text-[10px] text-slate-400" data-i18n="rmd_dedication_note">Wakaf atas nama Ayah/Ibu (yang masih hidup/wafat).</span>
                    </div>
                </label>
                <div id="boxDedikasi" class="hidden mt-3 animate-[fadeUp_0.3s_ease-out]">
                    <div class="relative">
                        <i data-lucide="heart-handshake" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-pink-500"></i>
                        <input id="inputDedikasi" type="text" data-placeholder="rmd_dedication_placeholder" placeholder="Contoh: Alm. Bpk Fulan" class="w-full pl-9 pr-4 py-2.5 rounded-xl border border-pink-200 focus:outline-none focus:border-pink-500 bg-pink-50/20 text-sm">
                    </div>
                </div>
              </div>
            </div>
          </div>

          <div class="p-5 bg-white border-t border-slate-100 rounded-b-2xl shrink-0">
            <button id="btnConfirmWakaf" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 rounded-xl shadow-lg transition-transform transform active:scale-95 flex items-center justify-center gap-2">
              <i data-lucide="message-circle" class="w-5 h-5"></i> <span data-i18n="rmd_btn_send">Konfirmasi via WA</span>
            </button>
          </div>
      </div>

      <div id="viewSuccess" class="hidden flex-col h-full items-center justify-center p-8 text-center animate-pop-in">
          <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mb-6 animate-pulse">
              <i data-lucide="check" class="w-10 h-10 text-emerald-600 stroke-[3]"></i>
          </div>
          <h3 class="text-2xl font-extrabold text-slate-800 mb-2">Alhamdulillah!</h3>
          <p class="text-slate-600 text-sm mb-6 leading-relaxed">
              Niat wakaf Anda telah kami catat. Semoga menjadi pemberat timbangan amal di akhirat kelak. Aamiin.
          </p>
          <div class="bg-amber-50 border border-amber-200 p-4 rounded-xl mb-8 w-full">
              <p class="text-[10px] text-amber-800 italic font-medium">
                  "Barangsiapa menunjukkan kebaikan, baginya pahala seperti yang melakukannya." <br>(HR. Muslim)
              </p>
          </div>
          <button id="btnShareWa" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2 mb-3">
              <i data-lucide="share-2" class="w-5 h-5"></i> Bagikan ke Grup Keluarga
          </button>
          <button onclick="location.reload()" class="text-slate-400 text-xs font-bold hover:text-slate-600 py-2">
              Tutup
          </button>
      </div>

    </div>
  </div>

  <footer class="bg-white py-8 text-center border-t border-slate-100 mt-10">
    <p class="text-sm text-slate-500">Â© 2026 Masjid As-Sunnah Hekinan</p>
  </footer>

  <script type="module" src="./app.js"></script>
  <script>
// Sinkronisasi Progress Donasi ke Halaman Ramadhan
document.addEventListener("DOMContentLoaded", () => {
  // Ambil data dari app.js yang sudah bersifat Global
  const T = 42000000; // Target
  const C = 9519843;  // Terkumpul (Sesuai konstanta Anda di app.js)
  
  const percent = Math.round((C / T) * 100);
  
  // Jika Anda menambahkan elemen progress di ramadhan.html seperti saran saya sebelumnya:
  const bar = document.querySelector(".bg-emerald-500.h-full");
  const label = document.querySelector(".text-emerald-600.font-bold"); // Elemen persentase
  
  if(bar) bar.style.width = percent + "%";
  if(label) label.textContent = percent + "%";
});
</script>
  <script>
  window.openRamadhanPopup = () => {
    const modal = document.getElementById("wakafModal");
    if(modal) { modal.classList.remove("hidden"); modal.classList.add("flex"); }
  };
  const closePopup = () => {
    const modal = document.getElementById("wakafModal");
    if(modal) { modal.classList.add("hidden"); modal.classList.remove("flex"); }
  };

  async function initSmartImsakiyah() {
      const LAT = 34.884, LON = 136.993; // Hekinan
      const today = new Date();
      const elLabel = document.getElementById("timeLabel"); 
      const elTimer = document.getElementById("timeCountdown");
      const elSubuh = document.getElementById("jadwalSubuh"); 
      const elMaghrib = document.getElementById("jadwalMaghrib");

      if(!elLabel) return; 

      try {
          const apiUrl = `https://api.aladhan.com/v1/timings/${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}?latitude=${LAT}&longitude=${LON}&method=2`;
          const res = await fetch(apiUrl);
          const data = await res.json();
          const timings = data.data.timings;

          if(elSubuh) elSubuh.textContent = timings.Fajr;
          if(elMaghrib) elMaghrib.textContent = timings.Maghrib;

          setInterval(() => {
    const now = new Date();
    const lang = localStorage.getItem("lang") || "id";
    const t = (window.TRANSLATIONS && window.TRANSLATIONS[lang]) ? window.TRANSLATIONS[lang] : {};

    const strTime = (timeStr) => {
        const [h, m] = timeStr.split(':');
        const d = new Date();
        d.setHours(h, m, 0, 0);
        return d;
    };

    const timeSubuh = strTime(timings.Fajr); 
    const timeMaghrib = strTime(timings.Maghrib);

    let targetDate, labelText, labelClass;

    if (now < timeSubuh) {
        targetDate = timeSubuh;
        // Menggunakan kunci rmd_time_sahur
        labelText = lang === 'en' ? "Sahur Time (Towards Fajr)" : "Waktu Sahur (Menuju Subuh)";
        labelClass = "text-[10px] md:text-xs font-bold text-emerald-300 mb-1 uppercase tracking-wider";
    } else if (now >= timeSubuh && now < timeMaghrib) {
        targetDate = timeMaghrib;
        // Menggunakan kunci rmd_time_fasting
        labelText = lang === 'en' ? "Happy Fasting (Towards Maghrib)" : "Selamat Berpuasa (Menuju Maghrib)";
        labelClass = "text-[10px] md:text-xs font-bold text-white mb-1 uppercase tracking-wider";
    } else {
        targetDate = null;
        // Menggunakan kunci rmd_time_break
        labelText = lang === 'en' ? "Alhamdulillah It's Iftar Time" : "Alhamdulillah Telah Berbuka";
        labelClass = "text-[10px] md:text-xs font-bold text-emerald-400 mb-1 uppercase tracking-wider";
    }

    elLabel.className = labelClass;
    elLabel.textContent = labelText;

              if (targetDate) {
                  const diff = targetDate - now;
                  const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
                  const m = Math.floor((diff / (1000 * 60)) % 60);
                  const s = Math.floor((diff / 1000) % 60);
                  elTimer.textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
              } else {
                  elTimer.textContent = timings.Maghrib;
              }
          }, 1000);
      } catch (e) { console.error("Gagal jadwal:", e); }
  }

  function startFakeNotifications() {
    const names = ["Hamba Allah", "Ibu Fulanah", "Bpk. Abdullah", "Keluarga Rizki", "Seseorang", "Jamaah Hekinan"];
    const amounts = ["Â¥1.000", "Â¥3.000", "Â¥5.000", "Â¥10.000"];
    const toast = document.getElementById("liveToast");
    const tName = document.getElementById("toastName");
    const tAmount = document.getElementById("toastNominal");
    
    if(!toast) return;

    setInterval(() => {
        const lang = localStorage.getItem("lang") || "id";
        tName.textContent = names[Math.floor(Math.random() * names.length)];
        const amount = amounts[Math.floor(Math.random() * amounts.length)];
        
        // Perbaikan di sini: Logika ganti bahasa untuk notifikasi
        const textAction = lang === 'en' ? "Just donated" : "Baru saja wakaf";
        tAmount.innerHTML = `${textAction} <span class="font-bold text-amber-600">${amount}</span>`;
        
        toast.classList.remove("translate-y-24", "opacity-0");
        setTimeout(() => { toast.classList.add("translate-y-24", "opacity-0"); }, 4000);
    }, 15000);
}
  document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("btnCloseModal")?.addEventListener("click", closePopup);
      document.getElementById("modalBackdrop")?.addEventListener("click", closePopup);
      setTimeout(startFakeNotifications, 5000);
      initSmartImsakiyah();

      // SWITCH MODE
      let currentMode = 'daily';
      const btnDaily = document.getElementById("btnModeDaily");
      const btnWeekly = document.getElementById("btnModeWeekly");
      const activeBg = document.getElementById("modeActiveBg");
      const periodLabels = document.querySelectorAll(".label-period");

      const updateMode = (mode) => {
          currentMode = mode;
          const isEn = localStorage.getItem("lang") === "en";
          const txtDay = isEn ? "/day" : "/hari";
          const txtWeek = isEn ? "/week" : "/pekan";

          if (mode === 'daily') {
              activeBg.style.transform = "translateX(0)";
              btnDaily.classList.replace("text-slate-500", "text-emerald-600");
              btnWeekly.classList.replace("text-emerald-600", "text-slate-500");
              periodLabels.forEach(el => el.textContent = txtDay);
          } else {
              activeBg.style.transform = "translateX(100%)";
              btnWeekly.classList.replace("text-slate-500", "text-emerald-600");
              btnDaily.classList.replace("text-emerald-600", "text-slate-500");
              periodLabels.forEach(el => el.textContent = txtWeek);
          }
      };

      btnDaily.addEventListener("click", () => updateMode('daily'));
      btnWeekly.addEventListener("click", () => updateMode('weekly'));
      
      document.addEventListener('langChanged', () => updateMode(currentMode));

      // DEDIKASI
      const checkDedikasi = document.getElementById("checkDedikasi");
      const boxDedikasi = document.getElementById("boxDedikasi");
      const inputDedikasi = document.getElementById("inputDedikasi");
      checkDedikasi?.addEventListener("change", (e) => {
          if(e.target.checked) { boxDedikasi.classList.remove("hidden"); inputDedikasi.focus(); } 
          else { boxDedikasi.classList.add("hidden"); }
      });

      // RADIO & IMPACT
      const radios = document.querySelectorAll('input[name="nominalWakaf"]');
      const customBox = document.getElementById("customInputBox");
      const customInput = document.getElementById("inputCustomNominal");
      const impactBox = document.getElementById("impactBox");
      const impactText = document.getElementById("impactText");

      const impacts = {
          "1000": "Amal ringan, berat di timbangan akhirat.",
          "5000": "Perekat ukhuwah & pengokoh bangunan masjid.",
          "10000": "Patungan <b class='text-emerald-600'>15% Lahan Surga</b> (1/7 Meter).",
          "custom": "Setiap Yen adalah saksi pembelaan di Yaumul Hisab."
      };

      radios.forEach(radio => {
        radio.addEventListener("change", (e) => {
            const val = e.target.value;
            if(val === "custom") { customBox.classList.remove("hidden"); customInput?.focus(); } 
            else { customBox.classList.add("hidden"); }
            if(impactBox && impactText) {
                impactBox.classList.remove("hidden"); impactBox.classList.add("flex");
                impactText.innerHTML = impacts[val] || impacts["custom"];
            }
        });
      });

      // KIRIM WA
      document.getElementById("btnConfirmWakaf")?.addEventListener("click", () => {
        const nama = document.getElementById("inputNamaPeserta").value;
        const selectedRadio = document.querySelector('input[name="nominalWakaf"]:checked');
        const lang = localStorage.getItem("lang") || "id";
        const isEn = lang === "en";

        if (!selectedRadio) { alert(isEn ? "Select amount." : "Pilih nominal wakaf."); return; }
        if (!nama) { alert(isEn ? "Enter name." : "Isi nama Anda."); document.getElementById("inputNamaPeserta").focus(); return; }

        let nominal = 0;
        if(selectedRadio.value === "custom") {
            nominal = parseInt(customInput.value);
            if(!nominal) { alert(isEn ? "Enter amount." : "Isi nominal manual."); return; }
        } else { nominal = parseInt(selectedRadio.value); }

        const multiplier = currentMode === 'daily' ? 30 : 4;
        const periodText = currentMode === 'daily' ? (isEn ? "30 Days" : "30 Hari Ramadhan") : (isEn ? "4 Fridays" : "4 Pekan");
        const freqText = currentMode === 'daily' ? "/hari" : "/pekan";
        const total = nominal * multiplier; 
        const fmt = (n) => new Intl.NumberFormat(isEn ? 'en-US' : 'id-ID').format(n);
        
        let dedicationText = "";
        if(checkDedikasi && checkDedikasi.checked) {
            const namaOrtu = inputDedikasi.value;
            if(namaOrtu) { dedicationText = isEn ? `\nðŸ’ *On Behalf of:* ${namaOrtu}` : `\nðŸ’ *Niat Pahala Untuk:* ${namaOrtu}`; }
        }

        let text = isEn 
            ? `Assalamu'alaikum. Bismillah, I join *Ramadan Waqf* (Hekinan).\n\nðŸ‘¤ Name: ${nama}\nðŸ’° Commitment: Â¥${fmt(nominal)} ${freqText}\nðŸ—“ï¸ Duration: ${periodText}\n(Total: Â¥${fmt(total)})${dedicationText}\n\nPlease record this.`
            : `Assalamu'alaikum. Bismillah, saya ikut *Wakaf Rutin Ramadhan* (Hekinan).\n\nðŸ‘¤ Nama: ${nama}\nðŸ’° Komitmen: Â¥${fmt(nominal)} ${freqText}\nðŸ—“ï¸ Selama: ${periodText}\n(Total: Â¥${fmt(total)})${dedicationText}\n\nMohon dicatat & didoakan. Jazakumullah khairan.`;

        window.open(`https://wa.me/818013909425?text=${encodeURIComponent(text)}`, "_blank");
        document.getElementById("viewForm").classList.add("hidden");
        document.getElementById("viewSuccess").classList.remove("hidden");
        document.getElementById("viewSuccess").classList.add("flex");
      });

      document.getElementById("btnShareWa")?.addEventListener("click", () => {
          const shareText = "Assalamu'alaikum. Saya baru saja ikut Wakaf Rutin untuk Masjid Hekinan (Jepang). Yuk cari pahala jariyah bareng-bareng di bulan Ramadhan! ðŸŒ™\n\nKlik disini: https://assunnahhekinan.org/ramadhan.html";
          window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`, "_blank");
      });
  });
  </script>
</body>
</html>
